<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC Column Design Calculator</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        .site-header {
            background-color: #003366;
            color: #f9f9f9;
            margin-bottom: 20px;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 15px;
        }
        .image-button {
            display: inline-block;
            padding: 2px;
            border-radius: 8px;
            background-color: white;
            transition:background-color 0.2s;
            text-decoration: none;
        }
        .button-image {
            height: 45px;
            width: 45px;
            object-fit: contain;
            vertical-align: middle;
            border-radius: 8px;
        }
        .image-button:hover {
            background-color: #e0e0e0;
        }
        .site-footer {
            background-color: #f3a26d;
            color: white;
            text-align: center;
            padding: 10px 10px;
            margin-top: 80px;
            font-size: 14px;
        }
        body {
            font-family: Arial, sans-serif;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }
        input {
            margin-bottom: 10px;
        }
        select {
            margin-bottom: 10px;
        }
        button {
            margin-top: 10px;
        }
        .output {
            margin-top: 20px;
            white-space: pre-wrap;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .success {
            color: black;
            font-weight: bold;
        }
        .image {
            width: 280px;
            height: auto;
        }
        .centered {
            text-align: center;
        }
        .centered-img {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        input:disabled {
            background-color: #e0e0e0;
        }
        .page-content {
            padding: 0px 60px;
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="header-content">
            <div>
              <h1>REINFORCED CONCRETE CALCULATOR</h1>
          </div>
            <a href="https://obracewell.github.io/RCBeamCalculator/" class="image-button">
                <img src="https://raw.githubusercontent.com/obracewell/RCBeamAnalysisCalculator-SRB/refs/heads/main/assets/homebutton.png" alt="Button Icon" class="button-image"></a>
          </div>
    </header>

<div class="page-content">
    <h1 class="centered">Design: Square Column</h1>

    <img src="https://github.com/obracewell/RCanalysiscalculator/blob/main/assets/SRBlabeled.png?raw=true" 
        alt="Square Column Diagram" 
        class="image centered-img" />
    
    <p class="success">Input the following values:</p>
    
    <label for="fc">Compressive stress of concrete, f'<sub>c</sub> (psi): </label>
    <select id="fc">
        <option value="">Select</option>
        <option value="3000">3000</option>
        <option value="4000">4000</option>
    </select>
    <br>

    <label for="fy">Yield stress of steel, f<sub>y</sub> (psi): </label>
    <select id="fy">
        <option value="">Select</option>
        <option value="40000">40000</option>
        <option value="50000">50000</option>
        <option value="60000">60000</option>
    </select>
    <br>

    <label>Factored load, P<sub>u</sub>:</label><br>
    <div style="margin-left: 30px;">
        <label for="Pu">Direct input, P<sub>u</sub> (k) = </label>
        <input type="number" id="Pu" oninput="toggleLoadInputs()"><br>
        <p>OR calculate from live and dead loads, P<sub>u</sub> = 1.2(P<sub>D</sub>) + 1.6(P<sub>L</sub>) </p>
        <label for="Pd">Dead Load, P<sub>D</sub> (k) = </label>
        <input type="number" id="Pd" oninput="toggleLoadInputs()"><br>
        <label for="Pl">Live Load, P<sub>L</sub>= </label>
        <input type="number" id="Pl" oninput="toggleLoadInputs()"<br>
    </div>

    <label for="rhoi">Target steel reinforcing ratio, &#961 (%): </label>
    <select id="rhoi">
        <option value="">Select</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
    </select>
    <br>

    <button onclick="performAnalysis()">Calculate</button>

    <div id="output" class="output"></div>
   
    <div id="graph" style="width: 800px; height: 600px;"></div>
    <div id="graphButtons" style="margin-top: 10px; display: none;">
        <button onclick="copyGraphAsImage()">Copy Graph</button>
        <button onclick="downloadGraphImage()">Download Graph</button>
    </div>
</div>
    
    <script>
        function toggleLoadInputs() {
            const Pu = document.getElementById('Pu');
            const Pd = document.getElementById('Pd');
            const Pl = document.getElementById('Pl');

        if (Pu.value) {
          Pd.disabled = true;
          Pl.disabled = true;
        } else if (Pd.value || Pl.value) {
          Pu.disabled = true;
        } else {
          Pu.disabled = false;
          Pd.disabled = false;
          Pl.disabled = false;
        }
        }

        function getPuValue() {
            const PuInput = document.getElementById('Pu');
            const PdInput = document.getElementById('Pd');
            const PlInput = document.getElementById('Pl');

            const Pd = parseFloat(PdInput.value);
            const Pl = parseFloat(PlInput.value);

            if (!isNaN(Pd) || !isNaN(Pl)) {
              const dead = isNaN(Pd) ? 0 : Pd;
              const live = isNaN(Pl) ? 0 : Pl;
              return 1.2 * dead + 1.6 * live;
            } 
            const Pu = parseFloat(PuInput.value);
            if (!isNaN(Pu)) {
                return Pu;
            }
            return NaN;
          }
        
        function performAnalysis() {
            // Get input values
            const fc = parseFloat(document.getElementById('fc').value);
            const fy = parseFloat(document.getElementById('fy').value);
            const Pu = getPuValue();
            const rhoi = parseFloat(document.getElementById('rhoi').value);
            const phi = 0.65; //strength reduction factor
            const alpha = 0.8; //column interaction coefficient
            
            // Validate inputs
            if (isNaN(fc) || isNaN(fy) || isNaN(Pu) || isNaN(rhoi)) {
                alert("Please enter all values.");
                return;
            }

            let output = 'Results:\n\n';
            let errorMessage = '';
            
            //Calculate Agreq
            let Agreq = Pu / (phi*alpha*(0.0085*fc*(1-0.01*rhoi)+0.001*fy*0.01*rhoi));
                        




            

            // Always display results
            let finalOutput = `<span class="success">${output}</span>`;

            // Append error message if exists
            if (errorMessage) {
                finalOutput += `<br><span class="error">${errorMessage}</span>`;
            }

            // Display in output div
            document.getElementById('output').innerHTML = finalOutput;

            // Plot the graph
            plotGraph(b, d, c, a,fc, fy, As);

            document.getElementById('graphButtons').style.display = 'block';
        }
        
        function plotGraph(b, d, c, a, fc, fy, As) {
            const h = d + 2;
            const x_range = [-0.03 - b * 0.001, -0.03, 0.06];

            const traces = [
                {
                    x: [null],
                    y: [null],
                    mode: 'none',
                    name: `f'<sub>c</sub> = ${fc} psi`,
                    showlegend: true
                },
                {
                    x: [null],
                    y: [null],
                    mode: 'none',
                    name: `f<sub>y</sub> = ${fy} psi`,
                    showlegend: true
                },
                {
                    x: [null],
                    y: [null],
                    mode: 'none',
                    name: `A<sub>s</sub> = ${As.toFixed(2)} inÂ²`,
                    showlegend: true
                },
                {
                    x: [null],
                    y: [null],
                    mode: 'none',
                    name: `d = ${d} in`,
                    showlegend: true
                },
                {
                    x: [null],
                    y: [null],
                    mode: 'none',
                    name: `b = ${b} in`,
                    showlegend: true
                },
                {
                    x: [-0.03 - b * 0.001, -0.03],
                    y: [0, 0],
                    mode: 'lines',
                    line: { color: 'black' },
                    showlegend: false
                },
                {
                    x: [-0.03 - b * 0.001, -0.03],
                    y: [h, h],
                    mode: 'lines',
                    line: { color: 'black' },
                    showlegend: false
                },
                {
                    x: [(-0.03 - b * 0.001), (-0.03 - b * 0.001)],
                    y: [0, h],
                    mode: 'lines',
                    line: { color: 'black' },
                    showlegend: false
                },
                {
                    x: [-0.03, -0.03],
                    y: [0, h],
                    mode: 'lines',
                    line: { color: 'black' },
                    showlegend: false
                },
                {
                    x: [0, 0],
                    y: [0, h],
                    mode: 'lines',
                    line: { color: 'black' },
                    showlegend: false
                },
                {
                    x: [0.03, 0.03],
                    y: [0, h],
                    mode: 'lines',
                    line: { color: 'black' },
                    showlegend: false
                },
                {
                    x: [-0.02, 0.06],
                    y: [0, 0],
                    mode: 'lines',
                    line: { color: 'black' },
                    showlegend: false
                },
                {
                    x: [-0.02, 0.06],
                    y: [h, h],
                    mode: 'lines',
                    line: { color: 'black' },
                    showlegend: false
                },
                {
                    x: [-0.03 - b * 0.001, -0.03],
                    y: [h - c, h - c],
                    mode: 'lines',
                    line: { color: 'black', dash: 'dash' },
                    name: 'Neutral Axis: c'
                },
                {
                    x: [-0.03 - b * 0.001, -0.03],
                    y: [h - a, h - a],
                    mode: 'lines',
                    line: { color: 'blue', dash: 'dot' },
                    name: 'Compression Concrete Depth: a'
                },
                {
                    x: [-0.02, 0.06],
                    y: [h - c, h - c],
                    mode: 'lines',
                    line: { color: 'black', dash: 'dash' },
                    showlegend: false
                },
                {
                    x: [0.03, 0.035],
                    y: [h - a, h - a],
                    mode: 'lines',
                    line: { color: 'blue' },
                    name: 'Whitney Stress Block'
                },
                {
                    x: [0.03, 0.035],
                    y: [h - a * 0.2, h - a * 0.2],
                    mode: 'lines',
                    line: { color: 'blue' },
                    showlegend: false
                },
                {
                    x: [0.03, 0.035],
                    y: [h - a * 0.4, h - a * 0.4],
                    mode: 'lines',
                    line: { color: 'blue' },
                    showlegend: false
                },
                {
                    x: [0.03, 0.035],
                    y: [h - a * 0.6, h - a * 0.6],
                    mode: 'lines',
                    line: { color: 'blue' },
                    showlegend: false
                },
                {
                    x: [0.03, 0.035],
                    y: [h - a * 0.8, h - a * 0.8],
                    mode: 'lines',
                    line: { color: 'blue' },
                    showlegend: false
                },
                {
                    x: [0.035, 0.035],
                    y: [h - a, h],
                    mode: 'lines',
                    line: { color: 'blue' },
                    showlegend: false
                },
                {
                    x: [0.03, 0.04],
                    y: [h - d, h - d],
                    mode: 'lines',
                    line: { color: 'purple' },
                    name: 'Tensile Force in Steel'
                },
                {
                    x: [0.035, 0.045],
                    y: [h - a * 0.5, h - a * 0.5],
                    mode: 'lines',
                    line: { color: 'red' },
                    name: 'Compressive Force in Concrete'
                },
                {
                    x: [],
                    y: [],
                    mode: 'lines',
                    line: { color: 'green' },
                    name: 'Strain Line'
                }
            ];

            // Strain diagram points
            var xValues = [];
            var yValues = [];
            for (var y = 0; y <= h; y += 0.01) {
                var x = (0.003 / c) * (y - h) + 0.003;
                xValues.push(x);
                yValues.push(y);
            }
            traces[24].x = xValues;
            traces[24].y = yValues;

            const layout = {
                xaxis: { showticklabels: false, visible: false, scaleanchor: 'y', scaleratio: 1000 },
                yaxis: { showticklabels: false, visible: false, scaleanchor: 'x', scaleratio: 1 },
                showlegend: true,
                paper_bgcolor: "white",
                plot_bgcolor: "white"
            };

            // Steel reinforcement circle
            var circle = {
                type: 'circle',
                xref: 'x',
                yref: 'y',
                x0: -(61 + b) / 2000,
                y0: h - d - 0.5,
                x1: -(59 + b) / 2000,
                y1: h - d + 0.5,
                line: { color: 'grey' }
            };

            layout.shapes = [circle];

            Plotly.newPlot('graph', traces, layout, { staticPlot: true });
        }
        function toggleAsInput() {
            const barSize = document.getElementById('barSize').value;
            const numBars = document.getElementById('numBars').value;
            const rows = parseInt(document.getElementById('rows').value);
            const AsInput = document.getElementById('As');

            // Disable As input if all bar config inputs are filled
            if (barSize && numBars && rows) {
                AsInput.disabled = true;
                AsInput.placeholder = "Disabled (using bar selection)";
                AsInput.value = ""; // Optional: clear any existing As
            } else {
                AsInput.disabled = false;
                AsInput.placeholder = "";
            }
        }
        function toggleBarInputs() {
            const AsInput = document.getElementById('As');
            const barSize = document.getElementById('barSize');
            const numBars = document.getElementById('numBars');
            const rows = document.getElementById('rows');

            // Disable bar selection if As is entered
            if (AsInput.value.trim() !== "") {
                barSize.disabled = true;
                numBars.disabled = true;
                rows.disabled = true;

            // Optional: Clear bar inputs
                barSize.value = "";
                numBars.value = "";
                rows.value = "";
            } else {
                // Enable bar inputs again
                 barSize.disabled = false;
                numBars.disabled = false;
                rows.disabled = false;
            }
    toggleAsInput(); // Also update As input state
}
    function copyGraphAsImage() {
    const graphDiv = document.getElementById('graph');

        Plotly.toImage(graphDiv, { format: 'png' }).then(function(dataUrl) {
        fetch(dataUrl)
            .then(res => res.blob())
            .then(blob => {
                const item = new ClipboardItem({ 'image/png': blob });
                navigator.clipboard.write([item]).then(() => {
                    alert("Graph image copied to clipboard!");
                }).catch(() => {
                    alert("Failed to copy image. Your browser may not support image clipboard copying.");
                });
            });
    });
}

function downloadGraphImage() {
    const graphDiv = document.getElementById('graph');

    Plotly.toImage(graphDiv, { format: 'png' }).then(function(dataUrl) {
        const link = document.createElement('a');
        link.href = dataUrl;
        link.download = 'SRBAnalysisGraph.png';
        link.click();
    });
}
    </script>
<footer class="site-footer">
    <p>Reinforced Concrete Calculator created by Olivia Bracewell, UF Herbert Wertheim College of Engineering</p>
</footer>
</body>
</html>
